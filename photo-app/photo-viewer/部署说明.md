# 一键部署脚本使用说明

## 📦 三个脚本的区别

### 1. deploy.bat - 基础版（推荐新手）
- ✅ 无需额外工具
- 📤 自动提交并推送代码
- 🌐 支持代理设置（端口 4780）
- ⚠️ 需要手动在网页触发构建

**使用场景**：日常开发，快速上传代码

### 2. deploy-auto.bat - 自动版（推荐）
- ✅ 全自动：推送 + 触发构建
- 📦 自动触发 GitHub Actions
- 📊 显示构建状态
- ⚠️ 需要安装 GitHub CLI

**使用场景**：完全自动化，一键完成所有操作

### 3. release.bat - 发布版
- 🏷️ 创建版本 tag
- 📱 触发 Release APK 构建
- 🎯 用于正式发布
- 📥 自动创建 GitHub Release

**使用场景**：发布新版本到应用商店

---

## 🚀 快速开始

### 首次使用准备

1. **设置 Git 远程仓库**（如果还没设置）
   ```bash
   cd photo-app/photo-viewer
   git remote add origin https://github.com/sky2048/photo-app.git
   ```

2. **安装 GitHub CLI**（可选，deploy-auto.bat 需要）
   - 下载：https://cli.github.com/
   - 安装后运行：`gh auth login`

---

## 📝 使用方法

### 方法一：基础版（无需额外工具）

```bash
# 进入目录
cd photo-app/photo-viewer

# 运行脚本
deploy.bat
```

**操作流程**：
1. 选择是否使用代理（y/n）
2. 输入提交信息
3. 等待推送完成
4. 打开浏览器访问 Actions 页面
5. 点击 "Run workflow" 按钮
6. 等待构建完成，下载 APK

---

### 方法二：自动版（推荐）

```bash
# 进入目录
cd photo-app/photo-viewer

# 运行脚本
deploy-auto.bat
```

**操作流程**：
1. 选择是否使用代理（y/n）
2. 输入提交信息
3. 脚本自动完成所有操作
4. 等待几分钟后下载 APK

**下载 APK**：
```bash
# 查看构建状态
gh run list --repo sky2048/photo-app

# 下载最新的 APK
gh run download --repo sky2048/photo-app
```

---

### 方法三：发布正式版

```bash
# 进入目录
cd photo-app/photo-viewer

# 运行脚本
release.bat
```

**操作流程**：
1. 选择是否使用代理（y/n）
2. 输入版本号（如 1.0.0 或 v1.0.0）
3. 输入版本说明（可选）
4. 等待构建完成
5. 在 Releases 页面下载签名的 APK

---

## 🌐 代理设置

所有脚本都支持代理，端口为 **4780**

- 运行脚本时选择 `y` 启用代理
- 代理地址：`http://127.0.0.1:4780`
- 自动配置 Git 和环境变量

---

## 📥 下载 APK

### 方法 1：网页下载
1. 访问：https://github.com/sky2048/photo-app/actions
2. 点击最新的构建
3. 滚动到底部 "Artifacts"
4. 下载 `app-debug.zip`
5. 解压得到 APK

### 方法 2：命令行下载（需要 GitHub CLI）
```bash
# 下载最新构建的 APK
gh run download --repo sky2048/photo-app

# 下载特定构建
gh run download 123456789 --repo sky2048/photo-app
```

### 方法 3：Release 下载（正式版）
1. 访问：https://github.com/sky2048/photo-app/releases
2. 下载最新版本的 APK

---

## ⚙️ 常见问题

### Q: 推送失败怎么办？
A: 检查以下几点：
- 是否设置了远程仓库：`git remote -v`
- 是否有推送权限
- 网络是否正常（尝试启用代理）
- 分支名是否正确（main 或 master）

### Q: GitHub Actions 构建失败？
A: 访问 Actions 页面查看错误日志：
- 可能是依赖安装失败
- 可能是 Android 项目未初始化
- 检查 `capacitor.config.json` 配置

### Q: 如何初始化 Android 项目？
A: 运行以下命令：
```bash
cd photo-app/photo-viewer
npm install
npx cap add android
npx cap sync android
```

### Q: 如何配置签名密钥？
A: 参考 `ANDROID_BUILD.md` 文档中的签名配置部分

---

## 🔗 相关链接

- GitHub 仓库：https://github.com/sky2048/photo-app
- Actions 页面：https://github.com/sky2048/photo-app/actions
- Releases 页面：https://github.com/sky2048/photo-app/releases
- GitHub CLI：https://cli.github.com/

---

## 💡 提示

- 首次构建需要 5-10 分钟
- 后续构建约 3-5 分钟
- APK 文件保留 30 天
- Release APK 保留 90 天
- 建议使用 deploy-auto.bat 获得最佳体验
